/*
 * jQuery Mobile Framework : plugin to provide a date and time picker.
 * Copyright (c) JTSage
 * CC 3.0 Attribution.  May be relicensed without permission/notification.
 * https://github.com/jtsage/jquery-mobile-datebox
 */
(function(a){a.extend(a.mobile.datebox.prototype.options,{themeDateToday:"a",themeDayHigh:"e",themeDatePick:"a",themeDateHigh:"e",themeDateHighAlt:"e",themeDate:"d",calHighToday:true,calHighPick:true,calShowDays:true,calOnlyMonth:false,calWeekMode:false,calWeekModeDay:1,calWeekHigh:false,calControlGroup:false,calShowWeek:false,useTodayButton:false,useCollapsedBut:false,highDays:false,highDates:false,highDatesAlt:false,enableDates:false});a.extend(a.mobile.datebox.prototype,{_cal_gen:function(d,f,l,i,h){var b=0,e=0,k=1,g=1,c=[],m=[],j=false;for(b=0;b<=5;b++){if(j===false){m=[];for(e=0;e<=6;e++){if(b===0&&e<d){if(i===true){m.push([f+(e-d)+1,h-1])}else{m.push(false)}}else{if(b>3&&k>l){if(i===true){m.push([g,h+1]);g++}else{m.push(false)}j=true}else{m.push([k,h]);k++;if(k>l){j=true}}}}c.push(m)}}return c},_cal_check:function(h,f,g,e){var b=this,i=this.options,d={},c=new this._date(f,g,e,0,0,0,0).getDay();d.ok=true;d.iso=f+"-"+b._zPad(g+1)+"-"+b._zPad(e);d.comp=parseInt(d.iso.replace(/-/g,""),10);d.theme=i.themeDate;if(a.isArray(i.enableDates)&&a.inArray(d.iso,i.enableDates)<0){d.ok=false}else{if(h.checkDates){if((i.afterToday===true&&h.thisDate.comp()>d.comp)||(i.beforeToday===true&&h.thisDate.comp()<d.comp)||(i.notToday===true&&h.thisDate.comp()===d.comp)||(i.maxDays!==false&&h.maxDate.comp()<d.comp)||(i.minDays!==false&&h.minDate.comp()>d.comp)||(a.isArray(i.blackDays)&&a.inArray(c,i.blackDays)>-1)||(a.isArray(i.blackDates)&&a.inArray(d.iso,i.blackDates)>-1)){d.ok=false}}}if(d.ok){if(i.calHighPick&&e===h.presetDay){d.theme=i.themeDatePick}else{if(i.calHighToday&&d.comp===h.thisDate.comp()){d.theme=i.themeDateToday}else{if(a.isArray(i.highDatesAlt)&&(a.inArray(d.iso,i.highDatesAlt)>-1)){d.theme=i.themeDateHighAlt}else{if(a.isArray(i.highDates)&&(a.inArray(d.iso,i.highDates)>-1)){d.theme=i.themeDateHigh}else{if(a.isArray(i.highDays)&&(a.inArray(c,i.highDays)>-1)){d.theme=i.themeDayHigh}}}}}}return d}});a.extend(a.mobile.datebox.prototype._build,{calbox:function(){var h=this,c=this.options,e,b=false,f="ui-datebox-",k=false,l=false,d=false,j=false,g=false;if(typeof h.d.intHTML!=="boolean"){h.d.intHTML.remove()}h.d.headerText=((h._grabLabel()!==false)?h._grabLabel():h.__("titleDateDialogLabel"));h.d.intHTML=a("<span>");a('<div class="'+f+'gridheader"><div class="'+f+'gridlabel"><h4>'+h.__("monthsOfYear")[h.theDate.getMonth()]+" "+h.theDate.getFullYear()+"</h4></div></div>").appendTo(h.d.intHTML);a("<div class='"+f+"gridplus"+(h.__("isRTL")?"-rtl":"")+"'><a href='#'>"+h.__("nextMonth")+"</a></div>").prependTo(h.d.intHTML.find("."+f+"gridheader")).buttonMarkup({theme:c.themeDate,icon:"plus",inline:true,iconpos:"notext",corners:true,shadow:true}).on(c.clickEvent,function(i){i.preventDefault();if(h.calNext){if(h.theDate.getDate()>28){h.theDate.setDate(1)}h._offset("m",1)}});a("<div class='"+f+"gridminus"+(h.__("isRTL")?"-rtl":"")+"'><a href='#'>"+h.__("prevMonth")+"</a></div>").prependTo(h.d.intHTML.find("."+f+"gridheader")).buttonMarkup({theme:c.themeDate,icon:"minus",inline:true,iconpos:"notext",corners:true,shadow:true}).on(c.clickEvent,function(i){i.preventDefault();if(h.calPrev){if(h.theDate.getDate()>28){h.theDate.setDate(1)}h._offset("m",-1)}});b={today:-1,highlightDay:-1,presetDay:-1,startDay:h.__("calStartDay"),thisDate:new h._date(),maxDate:new h._date(),minDate:new h._date(),currentMonth:false,weekMode:0,weekDays:null};b.start=(h.theDate.copy([0],[0,0,1]).getDay()-h.__("calStartDay")+7)%7;b.thisMonth=h.theDate.getMonth();b.wk=h.theDate.copy([0],[0,0,1]).adj(2,(-1*b.start)+(h.__("calStartDay")===0?1:0)).getWeek(4);b.end=32-h.theDate.copy([0],[0,0,32,13]).getDate();b.lastend=32-h.theDate.copy([0,-1],[0,0,32,13]).getDate();b.presetDate=h._makeDate(h.d.input.val());b.thisDateArr=b.thisDate.getArray();b.theDateArr=h.theDate.getArray();b.checkDates=(a.inArray(false,[c.afterToday,c.beforeToday,c.notToday,c.maxDays,c.minDays,c.blackDates,c.blackDays])>-1);h.calNext=true;h.calPrev=true;if(b.thisDateArr[0]===b.theDateArr[0]&&b.thisDateArr[1]===b.theDateArr[1]){b.currentMonth=true}if(b.presetDate.comp()===h.theDate.comp()){b.presetDay=b.presetDate.getDate()}if(c.afterToday===true&&(b.currentMonth===true||(b.thisDateArr[1]>=b.theDateArr[1]&&b.theDateArr[0]===b.thisDateArr[0]))){h.calPrev=false}if(c.beforeToday===true&&(b.currentMonth===true||(b.thisDateArr[1]<=b.theDateArr[1]&&b.theDateArr[0]===b.thisDateArr[0]))){h.calNext=false}if(c.minDays!==false){b.minDate.adj(2,-1*c.minDays);if(b.theDateArr[0]===b.minDate.getFullYear()&&b.theDateArr[1]<=b.minDate.getMonth()){h.calPrev=false}}if(c.maxDays!==false){b.maxDate.adj(2,c.maxDays);if(b.theDateArr[0]===b.maxDate.getFullYear()&&b.theDateArr[1]>=b.maxDate.getMonth()){h.calNext=false}}k=a('<div class="'+f+'grid">').appendTo(h.d.intHTML);if(c.calShowDays){h._cal_days=h.__("daysOfWeekShort").concat(h.__("daysOfWeekShort"));b.weekDays=a("<div>",{"class":f+"gridrow"}).appendTo(k);if(h.__("isRTL")===true){b.weekDays.css("direction","rtl")}if(c.calShowWeek){a("<div>").addClass(f+"griddate "+f+"griddate-empty "+f+"griddate-label").appendTo(b.weekDays)}for(e=0;e<=6;e++){a("<div>"+h._cal_days[(e+b.startDay)%7]+"</div>").addClass(f+"griddate "+f+"griddate-empty "+f+"griddate-label").appendTo(b.weekDays)}}b.gen=h._cal_gen(b.start,b.lastend,b.end,!c.calOnlyMonth,h.theDate.getMonth());for(l in b.gen){j=a("<div>",{"class":f+"gridrow"});if(h.__("isRTL")){j.css("direction","rtl")}if(c.calShowWeek){a("<div>",{"class":f+"griddate "+f+"griddate-empty"}).text("W"+b.wk).appendTo(j);b.wk++;if(b.wk>52&&typeof b.gen[parseInt(l,10)+1]!=="undefined"){b.wk=new Date(b.theDateArr[0],b.theDateArr[1],((h.__("calStartDay")===0)?b.gen[parseInt(l,10)+1][1][0]:b.gen[parseInt(l,10)+1][0][0])).getWeek(4)}}for(d in b.gen[l]){if(c.calWeekMode){b.weekMode=b.gen[l][c.calWeekModeDay][0]}if(typeof b.gen[l][d]==="boolean"){a("<div>",{"class":f+"griddate "+f+"griddate-empty"}).appendTo(j)}else{g=h._cal_check(b,b.theDateArr[0],b.gen[l][d][1],b.gen[l][d][0]);if(b.gen[l][d][0]){a("<div>"+String(b.gen[l][d][0])+"</div>").addClass(b.thisMonth===b.gen[l][d][1]?(f+"griddate ui-corner-all ui-btn-up-"+g.theme+(g.ok?"":" "+f+"griddate-disable")):(f+"griddate "+f+"griddate-empty")).jqmData("date",((c.calWeekMode)?b.weekMode:b.gen[l][d][0])).jqmData("theme",b.thisMonth===b.gen[l][d][1]?g.theme:"-").jqmData("enabled",g.ok).jqmData("month",b.gen[l][d][1]).appendTo(j)}}}if(c.calControlGroup===true){j.find(".ui-corner-all").removeClass("ui-corner-all").eq(0).addClass("ui-corner-left").end().last().addClass("ui-corner-right").addClass("ui-controlgroup-last")}j.appendTo(k)}if(c.calShowWeek){k.find("."+f+"griddate").addClass(f+"griddate-week")}if(c.useTodayButton||c.useClearButton){j=a("<div>",{"class":f+"controls"});if(c.useTodayButton){a('<a href="#">'+h.__("calTodayButtonLabel")+"</a>").appendTo(j).buttonMarkup({theme:c.theme,icon:"check",iconpos:"left",corners:true,shadow:true}).on(c.clickEvent,function(i){i.preventDefault();h.theDate=new h._date();h.theDate=new h._date(h.theDate.getFullYear(),h.theDate.getMonth(),h.theDate.getDate(),0,0,0,0);h.d.input.trigger("datebox",{method:"doset"})})}if(c.useClearButton){a('<a href="#">'+h.__("clearButton")+"</a>").appendTo(j).buttonMarkup({theme:c.theme,icon:"delete",iconpos:"left",corners:true,shadow:true}).on(c.clickEvent,function(i){i.preventDefault();h.d.input.val("");h.d.input.trigger("datebox",{method:"clear"});h.d.input.trigger("datebox",{method:"close"})})}if(c.useCollapsedBut){j.addClass("ui-datebox-collapse")}j.appendTo(k)}h.d.intHTML.on(c.clickEvent+" vmouseover vmouseout","div."+f+"griddate",function(i){if(i.type===c.clickEvent){i.preventDefault();if(a(this).jqmData("enabled")){h.theDate.set(2,1).set(1,a(this).jqmData("month")).set(2,a(this).jqmData("date"));h.d.input.trigger("datebox",{method:"set",value:h._formatter(h.__fmt(),h.theDate),date:h.theDate});h.d.input.trigger("datebox",{method:"close"})}}else{if(a(this).jqmData("enabled")&&typeof a(this).jqmData("theme")!=="undefined"){if(c.calWeekMode!==false&&c.calWeekHigh===true){a(this).parent().find("div").each(function(){h._hoover(this)})}else{h._hoover(this)}}}});h.d.intHTML.on("swipeleft",function(){if(h.calNext){h._offset("m",1)}}).on("swiperight",function(){if(h.calPrev){h._offset("m",-1)}});if(h.wheelExists){h.d.intHTML.on("mousewheel",function(i,m){i.preventDefault();if(m>0&&h.calNext){h.theDate.set(2,1);h._offset("m",1)}if(m<0&&h.calPrev){h.theDate.set(2,1);h._offset("m",-1)}})}}})})(jQuery);